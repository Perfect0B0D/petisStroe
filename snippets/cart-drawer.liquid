{% comment %}
  Renders cart drawer

  Usage:
  {% render 'cart-drawer' %}
{% endcomment %}

{% if settings.cart_drawer_collection != blank %}
  {{ 'component-card.css' | asset_url | stylesheet_tag }}
{% endif %}

<style>
body{
  letter-spacing: normal;
}
.custom-cart-item__discounted-prices{
    display: flex;
    justify-content: space-between;
    position: absolute;
    right: 15px;
    transform: translateY(-25px);
  }
.custom-dropdown {
    position: relative;
    width: 60px; /* Adjust width as needed */
    cursor: pointer;
    user-select: none; /* Prevent text selection */
}
.custom-dropdown .selected{
    display: flex;
    justify-content: center;
    font-size: 12px;
    font-weight: 500;
    padding: 8px 12px;
    gap: 1rem;
    border-radius: 3px;
    border: 1px solid #EBEBEB;
    outline: none;
    align-items: center;
    line-height: 125%;
}

.dropdown-icon {
  transform: rotate(270deg);    
}

.options {
    display: none; /* Initially hide options */
    position: absolute;
    border: 1px solid #ccc;
    background-color: white;
    width: 100%;
    z-index: 1000;
}

.option {
    padding: 10px;
    cursor: pointer;
}

.option:hover {
    background-color: #f0f0f0;
}



  dl{
    display: none;
  }
  .custom-cart-drawer-item__saving{
    display: none;
  }
  .drawer {
    visibility: hidden;
  }
  {% if section.settings.enable_header_bg %}
    .cart-drawer .drawer__header {
      background: {{ section.settings.header_bg_color }};
    }
  {% endif %}
  {% if section.settings.enable_body_bg %}
    .cart-drawer__body {
      background: {{ section.settings.body_bg_color }};
    }
  {% endif %}
  {% if section.settings.enable_footer_bg %}
    .cart-drawer .drawer__footer {
      background: {{ section.settings.footer_bg_color }};
    }
  {% endif %}
  .cart_header{
    top: 5px;
    display: flex;
    flex-direction: column;
    width: 100%;
  }
  .cart-drawer__discounts .badge{
    padding: 0.5rem 1rem;
    background: #E7EEE9;
  }
  .cart_header_top{
    display: flex;
    justify-content: space-between;
    padding: 16px 15px;
    align-items: center;
  }
  .drawer__close{
    position: relative;
    right: 0px !important;
    width: 10.5px;
    color: rgba(40, 59, 45, 1);
    flex-shrink: 0;
    min-width: 0;
    min-height: 0;
    top: 0;
    transform: none;

  }
  #options-container{
    height: 250px;
    overflow: auto;
    display: block;
  }
  .drawer__close svg {
    top: 0;
    transform: none;
  }
  .cart_heading{
    margin: 0; 
    color: #283B2D;
    font-family: Poppins;
    font-size: 18px;
    font-style: normal;
    font-weight: 600;
    line-height: 125%;
  }
  .trustpilot-widget{
    display: flex;
    padding: 12px 10px;
    justify-content: center;
    gap: 1rem;
    border-top: 1px solid rgba(40, 59, 45, 0.15);
    background: #FFF8F0;
    align-items: center;
  }
  .trustpilot-widget svg{
    height: 15px;
    width: 75px;
  }
  .trustpilot-widget span{
    color: #283B2D;
    text-align: center;
    font-family: Poppins;
    font-size: 14px;
    font-style: normal;
    font-weight: 600;
    line-height: 150%;
  }
  .drawer__inner-empty{
    padding: 0;
  }
  .card_empty_header_text{
    color: #283B2D;
    text-align: center;
    font-family: Poppins;
    font-size: 20px;
    font-style: normal;
    font-weight: 600;
    line-height: 125%;
    margin: 0;
  }
  .cart-drawer__empty-content{
    display: flex;
    padding: 10px;
    flex-direction: column;
    align-items: center;
    gap: 32px;
  }
  .cart-drawer-empty-text-wrapper{
    display: flex;
    width: 279px;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 12px;
  }
  .card_empty_content_text{
    color: #283B2D;
    text-align: center;
    font-family: Poppins;
    font-size: 16px;
    font-style: normal;
    font-weight: 400;
    line-height: 135%; 
    margin: 0;
  }
  .cart-drawer__empty-content a{
    width:  100%;
  }
  .our_story_btn{
    margin-top: 1rem;
    background: none;
    color: #608c6c;
  }
  .drawer__inner-empty{
    overflow: auto;
  }
  .drawer__header{
    justify-content: space-between;
  }
 .cart_offer_section{
    margin: 20px 10px;
    padding: 6px 10px;
    text-align: center;
    background: #E7EEE9;
    border-radius: 5px;
 }
 .drawer_body_banner{
    position: relative;
    background: #E7EEE9;
    border-radius: 5px;
    margin-top: auto;
    margin-bottom: auto;
 }
 .drawer_body_banner .banner{
  background: #283B2D;
    color: white;
    padding: 1rem;
    border-radius: 5px;
    position: absolute;
    left: 50%;
    transform: translate3d(-50%, -50%, 0px);
 }
 .drawer_body_banner .content{
  padding: 25px 10px 12px 10px;
  text-align: center;
 }
 #CartDrawer-CartErrors{
  display: none;
 }
 cart-drawer-items{
  border-bottom: 1px solid #d2cdcd;
  padding-bottom: 1rem;
  margin: 0rem !important;
 }
 .item__count{
  width: 20px;
    height: 20px;
    background: #283b2d;
    color: white;
    font-size: 12px;
    border-radius: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    top: 50%;
 }
 .drawer__heading{
  color: #283b2d;
 }
 .color-icon-text, :root {
    --color-icon: #FFDF4D;
}
.rating-star:before{
  content: "\2605\2605\2605\2605\2605";
    background: #FFDF4D;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
.saveings__money::before {
  content: "";
    display: block;
    background-color: #E7EEE9;
    position: absolute;
    width: 130%;
    height: 120%;
    top: -3px;
    left: -10px;
    z-index: -1;
    padding: 1rem;
}
.saveings__money{
  position: relative;
}
span{
  z-index: 1;
}

.drawer__footer{
  background-color: rgb(255 248 240);
}
.product__text-container{
  margin: 0 !important;
}
.product__text-container img{
  margin-right: 7px;
}

.cart-item__details{
  font-size: 2rem;
  margin-top: -5px;
} 

#shopify-section-cart-drawer{
  position: relative;
  z-index: 2147483649 !important;
}
#quantity{
  outline: none;
}
#quantity:focus-visible{
  box-shadow: none;
}
.custom-quantity{
  visibility: hidden;
  width: 0px !important;
}
#CartDrawer-CartItems{
  padding-bottom: 1rem;
}
.cart-item__name{
  margin: 0;
  font-size: 16px;
  font-weight: 700;
}
.cart-drawer__footer__discounts .badge{
   display: none; 
}
.continue_shopping_btn{
  display: flex;
  text-decoration: none;
    padding: 14px 56px;
    justify-content: center;
    align-items: center;
    gap: 10px;
    flex: 1 0 0;
    border-radius: 5px;
    background: #618C6D;
    margin: 0;
    color: var(--White, #FFF);
    font-family: Poppins;
    font-size: 16px;
    font-style: normal;
    font-weight: 600;
    line-height: 125%;
    letter-spacing: normal;
    outline: none;
    transition: box-shadow .5s ease-in-out;
}
.payment-badges{
  gap: 10px;
}
.continue_shopping_btn:hover{
  box-shadow: inset  -150px 0 0 0 white, inset  150px 0 0 0 white;
  /* background: white; */
  color: #618C6D;
  border: 1px solid #618C6D;
}
.our_story_btn{
  text-decoration: none;
  display: flex;
padding: 14px 50px;
justify-content: center;
align-items: center;
gap: 10px;
flex: 1 0 0;
border-radius: 5px;
border: 1px solid #618C6D;
color: #618C6D;
font-family: Poppins;
font-size: 16px;
font-style: normal;
font-weight: 600;
line-height: 125%; /* 20px */
margin: 0;
outline: none;
/* transition: box-shadow .5s ease-in-out; */
}


.our_story_btn:hover{
  border: none;
  background: #618C6D;
  color: white;
  border: 1px solid #618C6D;
}
.drawer__footer{
   padding: 10px 10px;
}
.cart-drawer__footer{
  border-bottom: 1px solid #c5c5c5;
  margin: 0;
  padding-bottom: 10px !important;
}
.cart-drawer__totals{
  gap: 8px;
}
.cart-drawer__total-savings{
  margin: 0;
}
.cart__ctas .button{
  background-color: #283B2D !important;
  letter-spacing: normal;
}
.cart__ctas .button:hover{
    background-color: #608C6C !important;
    letter-spacing: normal;
    color: white !important;
}
.cart__ctas .button:hover .button__label{
  color: white !important;
}
.cart__ctas .button::after{
  display: none;
}
.cart__ctas .button::before{
  display: none;
}
.product__text{
  font-size: 14px;
}
.custom-cart-drawer__body{
  padding: 0 10px;
  display: flex;
  flex-direction:column;
  justify-content: space-between;
  gap: 20px;
}
.custom_add__quantity{
  display: inline-flex;
padding: 10px;
justify-content: center;
align-items: center;
gap: 10px;
border-radius: 3px;
background: #618C6D;
color: #FFF;
font-family: Poppins;
font-size: 13px;
font-style: normal;
font-weight: 600;
line-height: 125%; /* 17.5px */
width: 100%;
text-decoration: none;
}

.custom_add__quantity:hover{
  /* background: #DAE8CD; */
  color: black;
}


@media screen and (min-width: 500px){
  .trustpilot-widget span{
    font-size: 14px;
  }
}

</style>

<cart-drawer class="custom-drawer drawer{% if cart == empty %} is-empty{% endif %}{% if section.settings.test_mode %} active{% endif %} cart-drawer--desktop-width-{{ section.settings.desktop_width }} cart-drawer--mobile-width-{{ section.settings.mobile_width }}" data-type='modal'>
  <div id="CartDrawer" class="cart-drawer">
    <div id="CartDrawer-Overlay" class="cart-drawer__overlay"></div>
    <div
      class="drawer__inner"
      role="dialog"
      aria-modal="true"
      aria-label="{{ 'sections.cart.title' | t }}"
      tabindex="-1"
    >
      {%- if cart == empty -%}
        <div class="drawer__inner-empty">
          <div class="cart_header">
            <div class="cart_header_top">
              <h2 class="cart_heading">{{ section.settings.heading_text }}</h2>
              <button
                class="drawer__close"
                type="button"
                onclick="this.closest('cart-drawer').close()"
                aria-label="{{ 'accessibility.close' | t }}"
              >
                {% render 'icon-close' %}
              </button>
            </div>
            <div class="trustpilot-widget">
                {% render 'icon-trustpilot' %}
                  <div style="display: flex; gap: 5px;">
                  <span style="font-weight: 400;">Excellent sur</span><span> +288 avis vérifiés</span>
                  </div>
                </div>
         </div>  
          <div class="cart-drawer__warnings center{% if settings.cart_drawer_collection != blank %} cart-drawer__warnings--has-collection{% endif %}">
      
          <div class="cart-drawer__empty-content">
              {% comment %} <h2 class="cart__empty-text">{{ 'sections.cart.empty' | t }}</h2> {% endcomment %}
              <div class="cart-drawer-empty-text-wrapper">
                <p class="card_empty_header_text">Aïe, votre panier est vide...</p>
                <p class="card_empty_content_text">Découvrez le microscope portable pour les petits aventuriers !</p>
              </div>
              <div class="cart-drawer-empty-text-wrapper">
                {% if settings.display_continue_shopping %}
                  <a href="{% if settings.continue_shopping_url == blank %}{{ routes.all_products_collection_url }}{% else %}{{ settings.continue_shopping_url }}{% endif %}" class="continue_shopping_btn">
                    Le Petiscope
                  </a>
                {% endif %}

                <a class="our_story_btn" href="{% if settings.continue_shopping_url == blank %}{{ routes.all_products_collection_url }}{% else %}{{ settings.continue_shopping_url }}{% endif %}">
                    Notre histoire
                </a>
              </div>
              {%- if shop.customer_accounts_enabled and customer == null -%}
                <p class="cart__login-title h3">{{ 'sections.cart.login.title' | t }}</p>
                <p class="cart__login-paragraph">
                  {{ 'sections.cart.login.paragraph_html' | t: link: routes.account_login_url }}
                </p>
              {%- endif -%}
            
            </div>
          </div>
          {% if section.settings.featured_product %}
            <div class="cart-drawer__product-list">
                {% assign custom_featured_product = all_products[section.settings.featured_product] %}
                {% render 'card-product-cart',
                card_product: custom_featured_product,
                media_aspect_ratio: section.settings.image_ratio,
                show_secondary_image: section.settings.show_secondary_image,
                badges: section.settings.badges,
                show_vendor: section.settings.show_vendor,
                show_rating: section.settings.show_rating,
                lazy_load: lazy_load,
                show_quick_add: true,
                section_id: section.id,
                horizontal_class: true
              %}
            </div>
          {% endif %}
          {%- if settings.cart_drawer_collection != blank -%}
            <div class="cart-drawer__collection">
              {% render 'card-collection', card_collection: settings.cart_drawer_collection, columns: 1 %}
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}
      
     
      <div class="drawer__header cart_header_top" style='--alignment:{{ section.settings.heading_alignment }}'>
        <h2 class="drawer__heading cart_heading" style="display: flex; gap: 1rem; align-items:center;">
          {% if section.settings.heading_text contains '[count]' %}
            {% liquid
              assign non_upsell_count = cart.item_count
              for item in cart.items
                if item.product.tags contains 'cart-hidden'
                  assign non_upsell_count = non_upsell_count | minus: 1
                endif
              endfor
            %}
            {{ section.settings.heading_text | replace: '[count]', non_upsell_count }}
          {% else %}
            {{ section.settings.heading_text }}
          {% endif %}
          <span class="item__count">{{ cart.item_count }}</span>
        </h2>
        <button
          class="drawer__close"
          type="button"
          onclick="this.closest('cart-drawer').close()"
          aria-label="{{ 'accessibility.close' | t }}"
        >
          {% render 'icon-close' %}
        </button>
      </div>
      {%- if cart != empty -%}
        <div class="trustpilot-widget">
          {% render 'icon-trustpilot' %}
            <div style="display: flex; gap: 5px;">
            <span style="font-weight: 500;">Excellent sur</span><span> +288 avis vérifiés</span>
            </div>
          </div>
        <div class="cart_offer_section">
          {% comment %} <image src="https://cdn.shopify.com/s/files/1/0882/1207/8921/files/ba0ee91b222725914ed7a748aa6f9022.png?v=1728591082"></image> {% endcomment %}
          <span>🍂</span>
          <span style="font-size: 14px;">Offre de rentrée,</span><span style="font-size:14px; font-weight: 700;"> stock limités !</span>
        </div> 
      {%- endif -%}
      <div class="cart-drawer__body custom-cart-drawer__body">
        {% if section.blocks.size == 0 %}
          <h3 class='h3 center'>To customize the cart, add blocks to the Cart drawer section (under the Header group)</h3>
        {% endif %}
        {% assign total_compare_price = 0 %}
        {% for block in section.blocks %}
          {% case block.type %}
            {% when 'progress_bar' %}
              {% render 'cart-progress-bar', block: block %}
            {% when 'checkpoints_bar' %}
              {% render 'cart-checkpoints-bar', block: block %}
            {% when 'countdown_timer' %}
              {% capture timer %}
                <countdown-timer data-duration="{{ block.settings.timer_duration }}"></countdown-timer>
              {% endcapture %}
              <div class='cart-timer color-{{ block.settings.color_scheme }}' style="--font-size:{{ block.settings.font_size }}rem;--margin-top: {{ block.settings.margin_top | divided_by: 10.0 }}rem;--margin-bottom: {{ block.settings.margin_bottom | divided_by: 10.0 }}rem;" {{ block.shopify_attributes }}>
                {{ block.settings.timer_text | replace: '[timer]', timer }}
              </div>
            {% when 'cart_items' %}
              <cart-drawer-items
                {% if cart == empty %}
                  class=" is-empty"
                {% endif %}
                style="--image-size: {{ block.settings.image_size }}%;--title-size:{{ block.settings.title_size }}rem;--margin-top: {{ block.settings.margin_top | divided_by: 10.0 }}rem;--margin-bottom: {{ block.settings.margin_bottom | divided_by: 10.0 }}rem;" 
                {{ block.shopify_attributes }}
              >
                <form
                  action="{{ routes.cart_url }}"
                  id="CartDrawer-Form"
                  class="cart__contents cart-drawer__form"
                  method="post"
                >
                  <div id="CartDrawer-CartItems" class="drawer__contents js-contents">
                    {%- if cart != empty -%}
                      <div class="drawer__cart-items-wrapper">
                        <ul class="cart-items list-unstyled">
                          {%- for item in cart.items -%}
                            <li 
                              id="CartDrawer-Item-{{ item.index | plus: 1 }}" 
                              class="cart-drawer-item cart-item cart-item--product-{{ item.product.handle }}" 
                              role="row" data-index="{{ item.index | plus: 1 }}"
                            >
                              <div class="custom-cart-item__media cart-item__media" role="cell">
                                {% if item.image %}
                                  {% comment %} Leave empty space due to a:empty CSS display: none rule {% endcomment %}
                                  {% if block.settings.image_link %}<a href="{{ item.url }}" class="cart-item__link" tabindex="-1" aria-hidden="true"> </a>{% endif %}
                                  <img
                                    class="cart-item__image"
                                    src="{{ item.image | image_url: width: 300 }}"
                                    alt="{{ item.image.alt | escape }}"
                                    loading="lazy"
                                    width="150"
                                    height="{{ 150 | divided_by: item.image.aspect_ratio | ceil }}"
                                  >
                                {% endif %}
                              </div>

                              <div class='custom-cart-drawer-item__right cart-drawer-item__right' style="display: flex; flex-direction: column; justify-content:space-between;">
                                {% liquid 
                                  assign display_compare = false
                                  assign compare_price = 0
                                  assign has_props = false
                                  for variant in item.product.variants
                                    if variant.id == item.id 
                                      assign current_variant = variant
                                    endif
                                  endfor
                                  
                                  if block.settings.displayed_compare_prices == 'automatic'
                                    if item.original_line_price != item.final_line_price 
                                      assign display_compare = true
                                      assign compare_price = item.original_line_price
                                    elsif current_variant.compare_at_price > item.final_price
                                      assign display_compare = true
                                      assign compare_price = current_variant.compare_at_price | times: item.quantity
                                    endif
                                  elsif block.settings.displayed_compare_prices == 'product' and current_variant.compare_at_price > item.final_price
                                    assign display_compare = true
                                    assign compare_price = current_variant.compare_at_price | times: item.quantity
                                  elsif item.original_line_price != item.final_line_price
                                    assign display_compare = true
                                    assign compare_price = item.original_line_price
                                  endif
                                %}
                                <div class='cart-drawer-item__details-and-delete-btn'>
                                  <div class="cart-item__details" role="cell" headers="CartDrawer-ColumnProduct">
                                    {%- if settings.show_vendor -%}
                                      <p class="caption-with-letter-spacing light">{{ item.product.vendor }}</p>
                                    {%- endif -%}
        
                                   
                                    
                                    {% comment %} rating section {% endcomment %}
                                    {%- if  item.product.metafields.reviews.rating.value != blank -%}
                                      {% liquid
                                        assign rating_decimal = 0
                                        assign decimal = item.product.metafields.reviews.rating.value.rating | modulo: 1
                                        if decimal >= 0.3 and decimal <= 0.7
                                          assign rating_decimal = 0.5
                                        elsif decimal > 0.7
                                          assign rating_decimal = 1
                                        endif
                                      %}
                                      <div
                                        class="rating"
                                        role="img"
                                        aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: item.product.metafields.reviews.rating.value, rating_max: item.product.metafields.reviews.rating.value.scale_max }}"
                                      >
                                        <span
                                          aria-hidden="true"
                                          class="rating-star color-icon-{{ settings.accent_icons }}"
                                          style="--rating: {{ item.product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ item.product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"
                                        ></span> 
                                        {% comment %} <span
                                        aria-hidden="true"
                                        class="rating-star color-icon-{{ settings.accent_icons }}"
                                        style="--rating: 5; --rating-max: {{ item.product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"
                                      ></span> {% endcomment %}
                                      </div>
                                      <p class="rating-text caption">
                                        <span aria-hidden="true">
                                          {{- item.product.metafields.reviews.rating.value }} /
                                          {{ item.product.metafields.reviews.rating.value.scale_max -}}
                                        </span>
                                      </p>
                                      <p class="rating-count caption">
                                        <span aria-hidden="true" style="font-size: 12px;">({{ item.product.metafields.reviews.rating_count }})</span>
                                        {% comment %} <span aria-hidden="true">(1643)</span> {% endcomment %}
                                        <span class="visually-hidden">
                                          {{- item.product.metafields.reviews.rating_count }}
                                          {{ 'accessibility.total_reviews' | t -}}
                                        </span>
                                      </p>
                                    {%- endif -%}

                                  <{% if block.settings.title_link %}a href="{{ item.url }}"{% else %}h4{% endif %} class="cart-item__name h4 break">
                                    {{- item.product.title | escape -}}
                                  </{% if block.settings.title_link %}a{% else %}h4{% endif %}>
                                    {% comment %} {%- if item.original_price != item.final_price and block.settings.display_single_item_prices -%} {% endcomment %}
                                    {% comment %} {%- if item.original_price != item.final_price and block.settings.display_single_item_prices -%}
                                      {% assign has_props = true %}
                                      <div class="custom-cart-item__discounted-prices cart-item__discounted-prices cart-drawer-item__single-item-prices" style="display: flex; justify-content:space-between;">
                                        <span style="visibility: hidden;">
                                          <span class="visually-hidden">
                                            {{ 'products.product.price.regular_price' | t }}
                                          </span>
                                          <s class="cart-item__old-price product-option text-color-{{ block.settings.compare_price_color }}">
                                            {{- compare_price | divided_by: item.quantity | money -}}
                                          </s>
                                          <span class="visually-hidden">
                                            {{ 'products.product.price.sale_price' | t }}
                                          </span>
                                          <strong class="cart-item__final-price product-option text-color-{{ block.settings.price_color }}">
                                            {{ item.final_price | money }}
                                          </strong>
                                        </span>
                                        <div class="cart-drawer__discounts list-unstyled" role="list" aria-label="{{ 'customer.order.discount' | t }}">
                                          {%- for discount in item.discounts -%}
                                            <div class="badge">
                                              {% comment %} {%- render 'icon-discount' -%} {% endcomment %}
                                              {% comment %} <span style="font-size: 12px; font-weight:700;">-{{ discount.title }}</span>
                                            </div>
                                          {%- endfor -%}
                                        </div>
                                      </div> {% endcomment %} {% endcomment %}
                                      {% comment %} custom code {% endcomment %}
                                      {% comment %} {%- else -%} {% endcomment %}
                                        <div class="custom-cart-item__discounted-prices cart-item__discounted-prices cart-drawer-item__single-item-prices" style="display: flex; justify-content:space-between;">
                                          <div class="cart-drawer__discounts list-unstyled" role="list" aria-label="{{ 'customer.order.discount' | t }}">
                                            <div class="badge">
                                              {% comment %} {%- render 'icon-discount' -%} {% endcomment %}
                                              {% comment %} {% assign final_price = item.final_line_price %} {% endcomment %}
                                              {% assign final_price = cart.total_price %}
                                              {% if compare_price > final_price %}
                                                {% assign price_difference = compare_price | minus: final_price %}
                                                {% comment %} <p>{{ price_difference }}</p> {% endcomment %}
                                                {% assign discount_percentage = price_difference  | times: 100 | divided_by: compare_price %}
                                                <span style="font-size: 12px; font-weight: 700;">-{{ discount_percentage | round }}%</span>
                                              {% endif %}
                                            </div>
                                          </div>
                                        </div>
                                    {% comment %} {%- endif -%} {% endcomment %}
        
                                    {%- if item.product.has_only_default_variant == false
                                      or item.properties != blank
                                      or item.selling_plan_allocation != null
                                    -%}
                                      {% assign has_props = true %}
                                      <dl>
                                        {%- if item.product.has_only_default_variant == false -%}
                                          {% if block.settings.displayed_variants == 'compact' %}
                                            <div class="product-option">
                                              {{ item.options_with_values | map: 'value' | join: ' / ' }}
                                            </div>
                                          {% else %}
                                            {%- for option in item.options_with_values -%}
                                              <div class="product-option">
                                                <dt>{{ option.name }}:</dt>
                                                <dd>
                                                  {{ option.value -}}
                                                  {%- unless forloop.last %}, {% endunless %}
                                                </dd>
                                              </div>
                                            {%- endfor -%}
                                          {% endif %}
                                        {%- endif -%}
        
                                        {%- for property in item.properties -%}
                                          {%- assign property_first_char = property.first | slice: 0 -%}
                                          {%- if property.last != blank and property_first_char != '_' -%}
                                            <div class="product-option">
                                              <dt>{{ property.first }}:</dt>
                                              <dd>
                                                {%- if property.last contains '/uploads/' -%}
                                                  <a
                                                    href="{{ property.last }}"
                                                    class="link"
                                                    target="_blank"
                                                    aria-describedby="a11y-new-window-message"
                                                  >
                                                    {{ property.last | split: '/' | last }}
                                                  </a>
                                                {%- else -%}
                                                  {{ property.last }}
                                                {%- endif -%}
                                              </dd>
                                            </div>
                                          {%- endif -%}
                                        {%- endfor -%}
                                      </dl>
        
                                      <p class="product-option">{{ item.selling_plan_allocation.selling_plan.name }}</p>
                                    {%- endif -%}
                                  </div>
                                  {% comment %} <cart-remove-button
                                    class='cart-drawer-item__cart-remove-button'
                                    id="CartDrawer-Remove-{{ item.index | plus: 1 }}"
                                    data-index="{{ item.index | plus: 1 }}"
                                  >
                                    <button
                                      type="button"
                                      class="button button--tertiary"
                                      aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                                    >
                                      {% render 'icon-remove' %}
                                    </button>
                                  </cart-remove-button> {% endcomment %}
                                </div>

                                <div class='cart-drawer-item__quantity-and-prices{% if block.settings.prices_position == 'left' %} cart-drawer-item__quantity-and-prices--reverse{% endif %}{% if has_props != false %} cart-drawer-item__quantity-and-prices--has-props{% endif %}'>
                                  <div class="cart-item__quantity">
                                    <div class="cart-item__quantity-wrapper" style="align-items: center; gap:10px;">

                                      {% comment %} <select onchange="updateQuantity(this)">
                                        {% for i in (1..50) %}
                                        <option value="{{ i }}"{% if item.quantity == i%} selected{% endif %}>{{ i }}</option>
                                        {% endfor %}
                                      </select> {% endcomment %}

                                 
                                      <div class="custom-dropdown" id="custom-dropdown">
                                          <div class="selected" id="selected-option" onclick="onQuantitySelect()">
                                              {% if item.quantity %}
                                                  {{ item.quantity }}
                                              {% else %}
                                                  Select Quantity
                                              {% endif %}
                                              <span class="dropdown-icon" style="font-size: 15px;">&lt;</span> <!-- Line arrow icon -->
                                          </div>
                                          <div class="options" id="options-container" style="display: none;">
                                              {% for i in (1..50) %}
                                                  <div class="option" data-value="{{ i }}"{% if item.quantity == i %} style="font-weight: bold;"{% endif %}>
                                                      {{ i }}
                                                  </div>
                                              {% endfor %}
                                          </div>
                                      </div>

                                    

                                      <cart-remove-button
                                      class='cart-drawer-item__cart-remove-button'
                                      id="CartDrawer-Remove-{{ item.index | plus: 1 }}"
                                      data-index="{{ item.index | plus: 1 }}"
                                    >
                                      

                                      <button
                                        type="button"
                                        class="button button--tertiary"
                                        aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                                      >
                                        {% render 'icon-remove' %}
                                      </button>
                                    </cart-remove-button>
                                      <quantity-input 
                                        class="custom-quantity quantity cart-quantity color-{{ block.settings.quantity_container_color_scheme }}{% if block.settings.quantity_round_btns %} cart-quantity--round-btns{% endif %}{% if block.settings.quantity_outline_btns %} cart-quantity--outline-btns{% endif %}"
                                        style='
                                          --font-size:{{ block.settings.quantity_font_size | divided_by: 10.0 }}rem;
                                          --border-width:0.{{ block.settings.quantity_border_width }}rem;
                                          --border-color:{{ block.settings.quantity_border_color }};
                                          --corner-radius:{{ block.settings.quantity_corner_radius | divided_by: 10.0 }}rem;
                                          --container-padding:{{ block.settings.quantity_container_padding }}em;
                                          --input-padding:{{ block.settings.quantity_input_padding }}em;
                                          --separator-opacity:{{ block.settings.quantity_separators_opacity | divided_by: 100.0 }};
                                          --padding:{{ block.settings.quantity_padding }}em;
                                          --icon-size:{{ block.settings.quantity_btns_icon_size | divided_by: 100.0 }}em;
                                        '
                                      >
                                        <button class="quantity__button quantity__button--minus no-js-hidden color-{{ block.settings.quantity_btns_color_scheme }}" name="minus" type="button">
                                          <span class="visually-hidden">
                                            {{-
                                              'products.product.quantity.decrease'
                                              | t: product: item.product.title
                                              | escape
                                            -}}
                                          </span>
                                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill='currentColor'>
                                            <path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"/>
                                          </svg>
                                        </button>
                                        <input
                                          class="quantity__input"
                                          id="custom-quantity-control"
                                          type="number"
                                          data-quantity-variant-id="{{ item.variant.id }}"
                                          name="updates[]"
                                          value="{{ item.quantity }}"
                                          {% # theme-check-disable %}
                                          data-cart-quantity="{{ cart | item_count_for_variant: item.variant.id }}"
                                          min="{{ item.variant.quantity_rule.min }}"
                                          {% if item.variant.quantity_rule.max != null %}
                                            max="{{ item.variant.quantity_rule.max }}"
                                          {% endif %}
                                          step="{{ item.variant.quantity_rule.increment }}"
                                          {% # theme-check-enable %}
                                          aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                                          id="Drawer-quantity-{{ item.index | plus: 1 }}"
                                          data-index="{{ item.index | plus: 1 }}"
                                        >
                                        <button class="quantity__button quantity__button--plus no-js-hidden color-{{ block.settings.quantity_btns_color_scheme }}" name="plus" type="button">
                                          <span class="visually-hidden">
                                            {{-
                                              'products.product.quantity.increase'
                                              | t: product: item.product.title
                                              | escape
                                            -}}
                                          </span>
                                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill='currentColor'>
                                            <path d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"/>
                                          </svg>
                                        </button>
                                      </quantity-input>
                                    </div>
        
                                    <div
                                      id="CartDrawer-LineItemError-{{ item.index | plus: 1 }}"
                                      class="cart-item__error"
                                      role="alert"
                                    >
                                      <small class="cart-item__error-text"></small>
                                      <svg
                                        aria-hidden="true"
                                        focusable="false"
                                        class="icon icon-error"
                                        viewBox="0 0 13 13"
                                      >
                                        <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"/>
                                        <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
                                        <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z" fill="white"/>
                                        <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z" fill="white" stroke="#EB001B" stroke-width="0.7">
                                      </svg>
                                    </div>
                                  </div>
                                  
                                  <div class="cart-item__totals {{ block.settings.prices_position }}" role="cell">
                                    <div class="loading-overlay hidden">
                                      <div class="loading-overlay__spinner">
                                        <svg
                                          aria-hidden="true"
                                          focusable="false"
                                          class="spinner"
                                          viewBox="0 0 66 66"
                                          xmlns="http://www.w3.org/2000/svg"
                                        >
                                          <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                                        </svg>
                                      </div>
                                    </div>
        
                                    <div class="cart-item__price-wrapper" style="display: flex; align-items:center; justify-content: flex-end;">
                                      {% if display_compare %}
                                        {% liquid
                                          assign item_saving = compare_price | minus: item.final_line_price
                                          assign total_compare_price = total_compare_price | plus: compare_price
                                        %}
                                        <div class=" cart-item__discounted-prices">
                                          <span class="visually-hidden">{{ 'products.product.price.regular_price' | t }}</span>
                                          <span style="font-size: 14px; color:#283B2D;font-weight:700;" class="price--end regular-price accent-color-{{ block.settings.price_color }}">
                                            {% comment %} {{ item.final_line_price | money }} {% endcomment %}
                                            {{ cart.total_price | money }}
                                          </span>
                                          {% comment %} <s class="cart-item__old-price price--end compare-price accent-color-{{ block.settings.compare_price_color }}">
                                            {{ compare_price | money }}
                                          </s> {% endcomment %}
                                          <span class="visually-hidden">{{ 'products.product.price.sale_price' | t }}</span>
                                          {% comment %} <span class="price--end regular-price accent-color-{{ block.settings.price_color }}">
                                            {{ item.final_line_price | money }}
                                          </span> {% endcomment %}
                                          <s style="font-size: 14px;color: rgba(40, 59, 45, 0.50); font-weight:500" class="cart-item__old-price price--end compare-price accent-color-{{ block.settings.compare_price_color }}">
                                            {{ compare_price | money }}
                                          </s>
                                        </div>
                                        {% if block.settings.enable_savings %}
                                          <span class='custom-cart-drawer-item__saving text-color-{{ block.settings.savings_color }}'>
                                            {% capture saved_money_span  %}{{ item_saving | money_without_trailing_zeros }}{% endcapture %}
                                            {{ block.settings.savings_text | replace: '[amount]', saved_money_span }}
                                          </span>
                                        {% endif %}
                                      {% else %}
                                        {% liquid
                                          assign total_compare_price = total_compare_price | plus: item.original_line_price
                                        %}
                                        <span class="price--end regular-price accent-color-{{ block.settings.price_color }}">
                                          {{ item.original_line_price | money }}
                                        </span>
                                      {% endif %}
        
                                      {%- if item.variant.available and item.unit_price_measurement -%}
                                        <div class="unit-price caption">
                                          <span class="visually-hidden">{{ 'products.product.price.unit_price' | t }}</span>
                                          {{ item.variant.unit_price | money }}
                                          <span aria-hidden="true">/</span>
                                          <span class="visually-hidden"
                                            >&nbsp;{{ 'accessibility.unit_price_separator' | t }}&nbsp;</span
                                          >
                                          {%- if item.variant.unit_price_measurement.reference_value != 1 -%}
                                            {{- item.variant.unit_price_measurement.reference_value -}}
                                          {%- endif -%}
                                          {{ item.variant.unit_price_measurement.reference_unit }}
                                        </div>
                                      {%- endif -%}
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </li>
                          {%- endfor -%}
                        </ul>
                      </div>
                    {%- endif -%}
                    <p id="CartDrawer-LiveRegionText" class="visually-hidden" role="status"></p>
                    <p id="CartDrawer-LineItemStatus" class="visually-hidden" aria-hidden="true" role="status">
                      {{ 'accessibility.loading' | t }}
                    </p>
                  </div>
                  <div id="CartDrawer-CartErrors" role="alert"></div>
                </form>
              </cart-drawer-items>
            {% when 'product_upsells' %}
              {% if block.settings.position == 'body' %}
                {% liquid
                  if block.settings.display == 'globally'
                    assign display = true
                  else 
                    assign display = false
                    assign handles_array = block.settings.display_product_handles | split: ','
                    if handles_array contains product.handle
                      assign display = true
                    endif
                  endif
                %}
                {% if display %}
                  {% render 'upsell-block', block: block, type: 'cart-drawer' %}
                {% endif %}
              {% endif %}
            {% when 'gift' %}
              {% if block.settings.position == 'body' %}
                {% liquid
                  if block.settings.display == 'globally'
                    assign display = true
                  else 
                    assign display = false
                    assign handles_array = block.settings.display_product_handles | split: ','
                    if handles_array contains product.handle
                      assign display = true
                    endif
                  endif
                %}
                {% if display %}
                  {% render 'cart-gift', block: block %}
                {% endif %}
              {% endif %}
            {%- when 'text_with_icon' -%}
              {% if block.settings.position == 'body' %}
                {% render 'text-with-icon-block', block: block, margins: true, block_attributes: true %}
              {% endif %}
            {% when 'image' %}
              {% if block.settings.position == 'body' %}
                <div 
                  class="product-info__image-block" 
                  style="--image-width:{{ block.settings.width }}%;--image-alignment:{{ block.settings.alignment }};--border-radius:{{ block.settings.border_radius | divided_by: 10.0 }}rem;--margin-top: {{ block.settings.margin_top | divided_by: 10.0 }}rem;--margin-bottom: {{ block.settings.margin_bottom | divided_by: 10.0 }}rem;"
                  {{ block.shopify_attributes }} 
                >
                  {% if block.settings.image != blank %}
                    <div class="media media--transparent ratio" style="--ratio-percent: {{ 1 | divided_by: block.settings.image.aspect_ratio | times: 100 }}%">
                      {%- capture sizes -%}
                        (min-width: {% if section.settings.desktop_width == 'normal' %}430{% else %}580{% endif %}px) calc(370px * {{ block.settings.width | divided_by: 100 }}),
                        calc((100vw - {% if section.settings.mobile_width == 'partial' %}60{% else %}30{% endif %}px) * {{ block.settings.width | divided_by: 100 }})
                      {%- endcapture -%}
                      {{
                        block.settings.image
                        | image_url: width: 1500
                        | image_tag: loading: 'lazy', sizes: sizes, widths: '165, 360, 535, 750, 1070, 1250, 1500'
                      }}
                    </div>
                  {% else %}
                    {{ 'image' | placeholder_svg_tag: 'placeholder-svg placeholder' }}
                  {% endif %}
                </div>
              {% endif %}
            {%- when 'icon_with_text' -%}
              {% if block.settings.position == 'body' %}
                {% render 'icon-with-text',
                  block: block
                %}
              {% endif %}
            {%- when 'custom_liquid' -%}
              {% if block.settings.position == 'body' %}
                {{ block.settings.custom_liquid }}
              {% endif %}
          {% endcase %}
        {% endfor %}
        <div class="drawer_body_banner">
          <span class="banner" style="padding:4px 10px;font-weight: 700; font-size: 12px;">Économisez -67%</span>
          <div class="content">
            <h3 style="margin-bottom: 0;font-size: 14px;margin-top: 0;">Intéressé par notre offre ?</h3>
            <div style="display: flex; font-size:13px;justify-content:center;padding-bottom: 12px;">
              <p style="font-weight: 600;margin-top:6px;margin-bottom: 0;font-size: 11px;">{{ cart.item_count | plus : 1 }} Petiscopes </p> &nbsp;
              <p style="margin-top:6px;margin-bottom: 0; font-size:11px;">pour faire encore plus d’heureux !</p>
            </div>
            <div style="display: flex; justify-content: center; gap: 1rem">
              {%- for item in cart.items -%}
                {% liquid 
                   assign display_compare = false
                   assign compare_price = 0
                   assign has_props = false
                   for variant in item.product.variants
                     if variant.id == item.id 
                       assign current_variant = variant
                     endif
                   endfor
                   assign regular_price_custom = item.price
                   assign compare_price_custom = current_variant.compare_at_price 
                   assign item_quantity = item.quantity
                   
                 %}
                  <p style="font-size: 14px; text-decoration: line-through; color: gray; margin: 0;">
                    {{ total_compare_price | plus:compare_price_custom  | money }}
                  </p>
                  
                  <p style="font-size: 14px; font-weight: bold; margin: 0;">
                    {{ cart.total_price  | plus:regular_price_custom | money }}
                  </p>
              {%- endfor -%} 

            </div>
            

            <a class="custom_add__quantity" href="#" style="margin-top: 3px; cursor:hand !important;" onclick="addQuantity()">
              Cliquez pour profiter de l’offre
            </a>
          </div>
        </div>
      </div>
      <div class="drawer__footer">
        {% for block in section.blocks %}
          {% case block.type %}
            {% when 'discount_field' %}
              {% render 'cart-discount-field', block: block %}
            {% when 'cart_note' %}
              <details id="Details-CartDrawer" style="--margin-top: {{ block.settings.margin_top | divided_by: 10.0 }}rem;--margin-bottom: {{ block.settings.margin_bottom | divided_by: 10.0 }}rem;" {{ block.shopify_attributes }}>
                <summary>
                  <span class="summary__title">
                    {{ 'sections.cart.note' | t }}
                    {% render 'icon-caret' %}
                  </span>
                </summary>
                <cart-note class="cart__note field">
                  <label class="visually-hidden" for="CartDrawer-Note">{{ 'sections.cart.note' | t }}</label>
                  <textarea
                    id="CartDrawer-Note"
                    class="text-area text-area--resize-vertical field__input"
                    name="note"
                    placeholder="{{ 'sections.cart.note' | t }}"
                  >{{ cart.note }}</textarea>
                </cart-note>
              </details>
            {% when 'subtotals' %}
              <div class="cart-drawer__footer"  {{ block.shopify_attributes }}>
                <div class="cart-drawer__totals{% if block.settings.savings_position == 'bellow' %} cart-drawer__totals--reverse{% endif %}" role="status" style='--spacing:{{ block.settings.savings_spacing | divided_by: 10.0 }}rem;'>
                  {% if block.settings.display_total_savings %}
                    {% assign total_savings = total_compare_price | minus: cart.total_price %}
                    {% if total_savings > 0 %}
                      {% capture savings_money %}<span class='saveings__money cart-drawer__totals__row__money' style="background-color: #E7EEE9; color: #618C6D;">{{ total_savings | money }}</span>{% endcapture %}
                      <p style="font-size:16px; padding: 3px 0px;" class='cart-drawer__totals__row cart-drawer__totals__row--{{ block.settings.savings_alignment }} text-color-{{ block.settings.savings_text_color }}' style='--text-size:{{ block.settings.savings_text_size | divided_by: 10.0 }}rem;'>
                        <span>{{ block.settings.savings_left_text | replace: '[savings]', savings_money }}</span><span>{{ block.settings.savings_right_text | replace: '[savings]', savings_money }}</span>
                      </p>
                    {% endif %}
                  {% endif %}
                  {% if block.settings.display_subtotal %}
                    {% capture subtotal_money %}<span class='cart-drawer__totals__row__money'>{{ cart.total_price | money }}</span>{% endcapture %}
                    <div style="font-size: 18px; padding: 3px 0px;" class='cart-drawer__totals__row cart-drawer__totals__row--{{ block.settings.subtotal_alignment }} text-color-{{ block.settings.subtotal_text_color }}' style='--text-size:{{ block.settings.subtotal_text_size | divided_by: 10.0 }}rem;'>
                      <span>{{ block.settings.subtotal_left_text | replace: '[subtotal]', subtotal_money }}</span>
                      <div style="display: flex; gap:1rem;">
                        <span>{{ block.settings.subtotal_right_text | replace: '[subtotal]', subtotal_money }}</span>
                        <span style="text-decoration: line-through; color: gray;">{{ total_compare_price | money }}</span>
                      </div>
                    </div>
                  {% endif %}
                </div>
                {%- if block.settings.display_discounts and cart.cart_level_discount_applications.size > 0 -%}
                  <div class="cart-drawer__discounts cart-drawer__footer__discounts list-unstyled" style='--alignment:{{ block.settings.discounts_alignment }};' role="list" aria-label="{{ 'customer.order.discount' | t }}">
                    <span class='cart-drawer__discounts__label'>{{ block.settings.discounts_label }}</span>
                    {%- for discount in cart.cart_level_discount_applications -%}
                      <div class="badge">
                        {%- render 'icon-discount' -%}
                        <span>{{ discount.title }} (-{{ discount.total_allocated_amount | money }})</span>
                      </div>
                    {%- endfor -%}
                  </div>
                {%- endif -%}
                {% if block.settings.display_total_savings %}
                  {% capture total_savings_money %}
                    {{ total_compare_price | minus: cart.total_price | money_without_trailing_zeros }}
                  {% endcapture %}
                  <p class='cart-drawer__total-savings {{ block.settings.savings_alignment }} text-color-{{ block.settings.savings_text_color }}'>
                    {{ block.settings.savings_text | replace: '[amount]', total_savings_money }}
                  </p>
                {% endif %}
              </div>
            {% when 'checkout_btn' %}
              <style>
                {% if block.settings.enable_custom_color %}
                  #CartDrawer-Checkout {
                    --color-button: {{ block.settings.custom_color.red }}, {{ block.settings.custom_color.green }}, {{ block.settings.custom_color.blue }};
                  }
                {% endif %}
                #CartDrawer-Checkout {
                  --icon-scale: {{ block.settings.icon_scale | divided_by: 100.0 }}em;
                  --icon-spacing: {{ block.settings.icon_spacing }}px;
                }
                {% if block.settings.prefix_icon != blank %}
                  #CartDrawer-Checkout .button__label::before {
                    background-image: url('{{ block.settings.prefix_icon | image_url }}');
                  }
                {% endif %}
                {% if block.settings.suffix_icon != blank %}
                  #CartDrawer-Checkout .button__label::after {
                    background-image: url('{{ block.settings.suffix_icon | image_url }}');
                  }
                {% endif %}
              </style>
              <div style="display: flex; justify-content: space-between; padding: 12px 0px;">
                <p style="color: #283B2D; font-size:14px; font-weight: 500; margin:0;">Livraison standard</p>
                <p style="color: #283B2D; font-size:14px;font-weight: 700; margin:0;">Offerte</p>
              </div>
              <div class="cart__ctas" style="margin-top:0px; margin-bottom: 15px;" {{ block.shopify_attributes }}>
                <noscript>
                  <button type="submit" class="cart__update-button button button--secondary" form="CartDrawer-Form" style="background-color: #283B2D;">
                    {{ 'sections.cart.update' | t }}
                  </button>
                </noscript>
                <div class='tnc-checkbox-warning tnc-checkbox-warning--above-button hidden' style='margin-bottom: 0.6em;'></div>
                <button
                  type="submit"
                  id="CartDrawer-Checkout"
                  class="cart__checkout-button button{% if block.settings.prefix_icon != blank %} button--prefix-icon{% endif %}{% if block.settings.suffix_icon != blank %} button--suffix-icon{% endif %}"
                  name="checkout"
                  form="CartDrawer-Form"
                  {% if cart == empty %}
                    disabled
                  {% endif %}
                  style="font-size: 16px;"
                >
                  <span class='button__label'>
                    {{ 'sections.cart.checkout' | t }}
                    {% if block.settings.display_price %}
                      • {{ cart.items_subtotal_price | money }}
                    {% endif %}
                  </span>
                </button>
                {%- if block.settings.show_additional_checkout_buttons and additional_checkout_buttons -%}
                  <div class="cart__dynamic-checkout-buttons additional-checkout-buttons">
                    {{ content_for_additional_checkout_buttons }}
                  </div>
                {%- endif -%}
                <div class='tnc-checkbox-warning tnc-checkbox-warning--under-button hidden' style='margin-top: 0.6em;'></div>
              </div>
            {%- when 'payment_badges' -%}
              <div class='payment-badges-block' style="margin-top:8px; margin-bottom:0px;" {{ block.shopify_attributes }}>
                <ul class="payment-badges" role="list">
                  {% assign enabled_payment_types = shop.enabled_payment_types %}
                  {% if block.settings.enabled_payment_types != blank %}
                    {% assign enabled_payment_types = block.settings.enabled_payment_types | remove: ' ' | split: ',' %}
                  {% endif %}
            
                  {%- for type in enabled_payment_types -%}
                    {% assign payment_type = type | strip %}
                      {% if payment_type == 'american_express' %}
                        <li class="list-payment__item" style="background:white; border: 1px solid #ede7df; border-radius:3px; width: 38px; height: 24px;">
                        <!-- Use a custom American Express SVG or image -->
                         <img src="https://cdn.shopify.com/s/files/1/0882/1207/8921/files/American_express.png?v=1729072212" alt="American Express" class="icon icon--full-color">
                       </li>
                        {% else %}
                      <li class="list-payment__item">
                        <!-- Default behavior for other payment types -->
                        {{ payment_type | payment_type_svg_tag: class: 'icon icon--full-color' }}
                      </li>
                      {% endif %}
                  {%- endfor -%}
                </ul>
              </div>
            {%- when 'tnc_checkbox' -%}
              <div style="--margin-top: {{ block.settings.margin_top | divided_by: 10.0 }}rem;--margin-bottom: {{ block.settings.margin_bottom | divided_by: 10.0 }}rem;" {{ block.shopify_attributes }}>
                <style>
                  .tnc-chekcbox {
                    font-size: {{ block.settings.checkbox_text_size | divided_by: 10.0 }}rem;
                  }
                  .tnc-checkbox-warning {
                    font-size: {{ block.settings.warning_text_size | divided_by: 10.0 }}rem;
                    text-align: {{ block.settings.warning_alignment }};
                    color: {{ block.settings.warning_text_color }};
                  }
                </style>
                <tnc-chekcbox
                  class='tnc-chekcbox flex flex-align-center{% if block.settings.checkbox_alignment == 'center' %} center flex-justify-center{% endif %}'
                  data-checked="false"
                  data-disable-button="{{ block.settings.disable_checkout_button }}"
                  data-warning-text='{{ block.settings.warning_text }}'
                  data-warning-position='{{ block.settings.warning_position }}'
                >
                  <svg
                    class="checkmark-checked text-color-{{ block.settings.checkbox_color }} flex-shrink-0"
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 448 512"
                    fill="currentColor"
                    width="50"
                    height="50"
                  >
                    <path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM337 209L209 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L303 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"/>
                  </svg>
                  <svg
                    class="checkmark-unchecked text-color-{{ block.settings.checkbox_color }} flex-shrink-0"
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 448 512"
                    fill="currentColor"
                    width="50"
                    height="50"
                  >
                    <path d="M384 80c8.8 0 16 7.2 16 16V416c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V96c0-8.8 7.2-16 16-16H384zM64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64z"/>
                  </svg>
                  <p class="tnc-checkbox__text margin-0">
                    {{ block.settings.checkbox_text }}
                  </p>
                </tnc-chekcbox>
                <div class='tnc-checkbox-warning tnc-checkbox-warning--under-checkbox hidden' style='margin-top: 0.4em;'></div>
              </div>
            {% when 'product_upsells' %}
              {% if block.settings.position == 'footer' %}
                {% liquid
                  if block.settings.display == 'globally'
                    assign display = true
                  else 
                    assign display = false
                    assign handles_array = block.settings.display_product_handles | split: ','
                    if handles_array contains product.handle
                      assign display = true
                    endif
                  endif
                %}
                {% if display %}
                  {% render 'upsell-block', block: block, type: 'cart-drawer' %}
                {% endif %}
              {% endif %}
            {%- when 'text_with_icon' -%}
              {% if block.settings.position == 'footer' %}
                {% render 'text-with-icon-block', block: block, margins: true, block_attributes: true %}
              {% endif %}
            {% when 'image' %}
              {% if block.settings.position == 'footer' %}
                <div 
                  class="product-info__image-block" 
                  style="--image-width:{{ block.settings.width }}%;--image-alignment:{{ block.settings.alignment }};--border-radius:{{ block.settings.border_radius | divided_by: 10.0 }}rem;--margin-top: {{ block.settings.margin_top | divided_by: 10.0 }}rem;--margin-bottom: {{ block.settings.margin_bottom | divided_by: 10.0 }}rem;"
                  {{ block.shopify_attributes }} 
                >
                  {% if block.settings.image != blank %}
                    <div class="media media--transparent ratio" style="--ratio-percent: {{ 1 | divided_by: block.settings.image.aspect_ratio | times: 100 }}%">
                      {%- capture sizes -%}
                        (min-width: {% if section.settings.desktop_width == 'normal' %}430{% else %}580{% endif %}px) calc(370px * {{ block.settings.width | divided_by: 100 }}),
                        calc((100vw - {% if section.settings.mobile_width == 'partial' %}60{% else %}30{% endif %}px) * {{ block.settings.width | divided_by: 100 }})
                      {%- endcapture -%}
                      {{
                        block.settings.image
                        | image_url: width: 1500
                        | image_tag: loading: 'lazy', sizes: sizes, widths: '165, 360, 535, 750, 1070, 1250, 1500'
                      }}
                    </div>
                  {% else %}
                    {{ 'image' | placeholder_svg_tag: 'placeholder-svg placeholder' }}
                  {% endif %}
                </div>
              {% endif %}
            {%- when 'icon_with_text' -%}
              {% if block.settings.position == 'footer' %}
                {% render 'icon-with-text',
                  block: block
                %}
              {% endif %}
            {%- when 'custom_liquid' -%}
              {% if block.settings.position == 'footer' %}
                {{ block.settings.custom_liquid }}
              {% endif %}
          {% endcase %}
        {% endfor %}
        <!-- end footer -->
      </div>
    </div>
  </div>
</cart-drawer>

<script>
   const init_optionsContainer = document.getElementById('options-container');
   init_optionsContainer.style.display = 'none';
    function addQuantity(){
      const plusBtn = document.querySelector('.quantity__button--plus');
      plusBtn.click();
    }
    document.addEventListener('click', function() {
      init_optionsContainer.style.display = 'none';
    });

    function onQuantitySelect(){
              event.stopPropagation();
              const selectedOption = document.getElementById('selected-option');
              const optionsContainer = document.getElementById('options-container');
              const options = document.querySelectorAll('.option');
              const isVisible = optionsContainer.style.display === 'block';
              optionsContainer.style.display = isVisible ? 'none' : 'block';

              options.forEach(option => {
                option.addEventListener('click', function(event) {
                    event.stopPropagation(); // Prevent the click from bubbling up
                    const value = this.getAttribute('data-value');
                    selectedOption.firstChild.nodeValue = value; // Update selected text
                    optionsContainer.style.display = 'none'; // Hide options after selection
                    
                    // Update the value in the associated input if needed
                    const inputElement = document.querySelector('.quantity__input'); // Ensure you have the correct input selector
                    if (inputElement) {
                        inputElement.value = value; // Set input value to selected quantity
                        
                        // Dispatch a 'change' event if necessary
                        const event = new Event('change', { bubbles: true });
                        inputElement.dispatchEvent(event);
                    }
                });
            });
        }
  document.addEventListener('DOMContentLoaded', function () {
      function isIE() {
          const ua = window.navigator.userAgent;
          const msie = ua.indexOf('MSIE ');
          const trident = ua.indexOf('Trident/');

          return msie > 0 || trident > 0;
      }
      if (!isIE()) return;

      // Create and append hidden input for checkout
      const cartSubmitInput = document.createElement('input');
      cartSubmitInput.setAttribute('name', 'checkout');
      cartSubmitInput.setAttribute('type', 'hidden');
      document.querySelector('#cart').appendChild(cartSubmitInput);

    
      // Add click event listener to the checkout button
      document.querySelector('#checkout').addEventListener('click', function (event) {
          document.querySelector('#cart').submit();
      });
  });
  function adjustCartItemRightHeight(){
    const cartItemWrapper = document.querySelector('.custom-cart-drawer-item__right');
    const cartItemMedia = document.querySelector('.custom-cart-item__media');
    
    if (cartItemWrapper && cartItemMedia) {
        // Get the height of the cart item wrapper
        const mediaHeight = cartItemMedia.offsetHeight;
        
        // Set the height of the cart item media to match the wrapper
        cartItemWrapper.style.height = `${mediaHeight}px`;
    }
  }
      // Run when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', function () {
      adjustCartItemRightHeight();  // Initial adjustment
    });

    // Run when the window is resized
    window.addEventListener('resize', function () {
      adjustCartItemRightHeight();  // Adjust on window resize
    });

</script>

